# ðŸ”Ž Task 2 â€“ Investigating Potential C2 Communication (Elastic SIEM)

## Scenario Overview

An IDS alert indicated potential command-and-control (C2) communication originating from a user in the HR department. Due to limited resources, only HTTP connection logs were available and ingested into the connection_logs index in Kibana.

The objective was to analyze these logs using Elastic SIEM and determine:

The scope of activity

The infected machine

The download mechanism

The C2 infrastructure

The malicious file content

Link: https://tryhackme.com/room/itsybitsy


## 1. Executive Summary
This investigation analyzed HTTP logs using the ELK stack to identify suspicious activity and potential C2 communication. By filtering and correlating log data in Kibana, malicious indicators were uncovered, including suspicious IP traffic and abnormal user-agent behavior. The analysis led to reconstructing the C2 URL and identifying the compromised file, demonstrating practical SIEM-based threat investigation skills.

## Questions 

# 1. How many events were returned for the month of March 2022?

After going to the target IP and load Kibana. 
Click Discoveries â€” thatâ€™s where the logs are. 
The time range in Kibana Discover was adjusted to:

Mar 1, 2022 â†’ Mar 31, 2022

After applying the filter, the total number of events returned was:

--pic 

## ðŸ§  Knowledge Add-on â€“ Why This Matters
Establishing the total event count provides baseline visibility.
Analysts must first understand log volume before narrowing investigations.
A high event count over a short period may indicate automated activity.

# 2. What is the IP associated with the suspected user in the logs?

When I filtered by source_ip, two addresses appeared. The first one looked suspicious, 
but it was just a distraction. The real one causing the issue was the other IP, quietly hiding in the list.

The suspicious IP identified as associated with the compromised user:

--pic

## ðŸ§ Knowledge Add-on â€“ IP Correlation in SIEM
In Elastic investigations, identifying the correct source IP is critical.
Analysts must differentiate between noise and malicious patterns by:

-Checking frequency

-Reviewing associated user agents

-Correlating timestamps



# 3. The userâ€™s machine used a legit windows binary to download a file from the C2 server. What is the name of the binary?

Clicking on user_agent shows two entries with a suspicious ratio 
â€” most traffic comes from Mozilla, while a tiny bit comes from bitsadmin. Upon further research ,
bitsadmin is a Microsoft tool used for Windows updates.

--pic

## ðŸ§ Knowledge Add-on â€“ Living Off The Land (LOLBins)
Attackers often abuse legitimate Windows binaries such as:

bitsadmin
certutil
powershell

This technique is known as Living Off The Land (LOLBins) and is used to evade detection since the binary itself is trusted.

# 4. The infected machine connected with a famous filesharing site in this period, which also acts as a C2 server used by the malware authors to communicate. What is the name of the filesharing site?

"What filesharing site was contacted?"

Further log inspection revealed outbound connections to:

--pic  

## ðŸ§  Knowledge Add-on â€“ Why Pastebin is Abused
Public file-sharing platforms like Pastebin are frequently used as:

Dead drop resolvers
C2 instruction repositories
Data exfiltration staging points

Since they are legitimate services, blocking them entirely may disrupt business operations, making them attractive to attackers.


# 5. What is the full URL of the C2 to which the infected host is connected?

Following the same approach as the previous section, we check the host URI, which ultimately leads us straight to the answer
By reviewing the host and uri fields in Elastic, the full C2 endpoint was reconstructed:

--pic 

## ðŸ§  Knowledge Add-on â€“ URL Reconstruction in SIEM
In many SIEM investigations, the full URL is not directly displayed.
Analysts must combine:
Host field
URI field
HTTP method

Proper reconstruction helps determine:
Whether data was downloaded or uploaded
If the content is static or dynamic

# 6. A file was accessed on the filesharing site. What is the name of the file accessed?

Accessing the reconstructed URL revealed the name of the referenced file:

--pic

## ðŸ§  Knowledge Add-on â€“ Why File Names Matter
Malware often retrieves:
Configuration files
Encrypted payloads
Command instructions
The file name can reveal attacker intent and sometimes malware stage.

--pic 

â€” ! Weâ€™ve got it.

# 7. The file contains a secret code with the format THM{_____}.

Upon reviewing the file content, the embedded code was identified:
--pic 

## ðŸ§  Knowledge Add-on â€“ Real-World Parallel
In real SOC environments, this step would represent:
Extracting attacker instructions
Identifying encryption keys
Recovering embedded configuration data
Flags in CTF labs simulate command retrieval in real attacks.

##  Analyst Reflection
This case reinforced understanding of malware investigation workflows,
including alert validation, file reputation analysis, and identifying
malicious network behavior in a SOC environment.
